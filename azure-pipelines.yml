trigger:
  - main

pool:
  vmImage: ubuntu-latest

variables:
  dotnetVersion: '9.0.x'

steps:
  # Install .NET SDK
  - task: UseDotNet@2
    displayName: 'Install .NET SDK'
    inputs:
      packageType: 'sdk'
      version: $(dotnetVersion)
      installationPath: $(Agent.ToolsDirectory)/dotnet

  # Restore, Build, and Publish the API
  - script: |
      dotnet restore
      dotnet build --configuration Release
      dotnet publish -c Release -o $(Build.ArtifactStagingDirectory)/api
    displayName: 'Build & Publish API'

  # Publish the build artifacts
  - task: PublishBuildArtifacts@1
    displayName: 'Publish Build Artifacts'
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)/api'
      ArtifactName: 'api'
      publishLocation: 'Container'

  # Deploy to Azure App Service
  - task: AzureWebApp@1
    displayName: 'Deploy API to Azure'
    inputs:
      azureSubscription: 'Azure subscription 1(d6e91656-92a9-4186-974f-74f4177bfd67)'
      appName: 'image-gallery-backend'
      package: '$(Build.ArtifactStagingDirectory)/api'
      appType: 'webApp'  # Specify the app type here

